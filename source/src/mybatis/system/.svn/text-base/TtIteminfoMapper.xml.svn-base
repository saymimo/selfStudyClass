<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="TtIteminfoMapper" >
  <resultMap id="BaseResultMap" type="com.ssc.entity.system.TtIteminfo" >
    <id column="ITEM_ID" property="itemId" jdbcType="VARCHAR" />
    <result column="STRUCT_ID" property="structId" jdbcType="VARCHAR" />
    <result column="ENFORCESTATE" property="enforcestate" jdbcType="INTEGER" />
    <result column="ITEM_NUMBER" property="itemNumber" jdbcType="VARCHAR" />
    <result column="ITEM_NAME" property="itemName" jdbcType="VARCHAR" />
    <result column="ITEM_TYPE" property="itemType" jdbcType="CHAR" />
    <result column="WK_DATE" property="wkDate" jdbcType="INTEGER" />
    <result column="OTHER_UNIT" property="otherUnit" jdbcType="VARCHAR" />
    <result column="ITEM_MONEY" property="itemMoney" jdbcType="DECIMAL" />
    <result column="START_DATE" property="startDate" jdbcType="DATE" />
    <result column="END_DATE" property="endDate" jdbcType="DATE" />
    <result column="FUND_SOURCE" property="fundSource" jdbcType="VARCHAR" />
    <result column="JOB_FORMAT" property="jobFormat" jdbcType="VARCHAR" />
    <result column="DETAILS_ADDRESS" property="detailsAddress" jdbcType="VARCHAR" />
    <result column="ITEMEA_RMARK" property="itemeaRmark" jdbcType="VARCHAR" />
    <result column="ITEMZD_AREA" property="itemzdArea" jdbcType="VARCHAR" />
    <result column="ITEMDX_AREA" property="itemdxArea" jdbcType="VARCHAR" />
    <result column="ITEM_AREA" property="itemArea" jdbcType="VARCHAR" />
    <result column="ITEM_MASS" property="itemMass" jdbcType="VARCHAR" />
    <result column="ITEM_DEPICT" property="itemDepict" jdbcType="VARCHAR" />
    <result column="ITEM_PROVINCE" property="itemProvince" jdbcType="CHAR" />
    <result column="ITEM_CITY" property="itemCity" jdbcType="CHAR" />
    <result column="LOGIN_MANAGER" property="loginManager" jdbcType="VARCHAR" />
    <result column="FIRE_GRADE" property="fireGrade" jdbcType="CHAR" />
    <result column="QUAKE_GRADE" property="quakeGrade" jdbcType="CHAR" />
    <result column="IS_CURTAIN" property="isCurtain" jdbcType="CHAR" />
    <result column="BASIC_DESIGN" property="basicDesign" jdbcType="CHAR" />
    <result column="BORDER_GRADE" property="borderGrade" jdbcType="CHAR" />
    <result column="IS_FLOOR" property="isFloor" jdbcType="INTEGER" />
    <result column="PIT_GRADE" property="pitGrade" jdbcType="CHAR" />
    <result column="BIANPO_HIGHT" property="bianpoHight" jdbcType="DECIMAL" />
    <result column="JIEGOU_SHAPE" property="jiegouShape" jdbcType="CHAR" />
    <result column="PIT_SHENDU" property="pitShendu" jdbcType="DECIMAL" />
    <result column="BASEMENT_FLOOR" property="basementFloor" jdbcType="INTEGER" />
    <result column="STRUCTURE_FLOOR" property="structureFloor" jdbcType="INTEGER" />
    <result column="BUILDING_HIGHT" property="buildingHight" jdbcType="DECIMAL" />
    <result column="SPAN" property="span" jdbcType="DECIMAL" />
    <result column="IS_DEL" property="isDel" jdbcType="INTEGER" />
    <result column="CREATE_DATE" property="createDate" jdbcType="TIMESTAMP" />
    <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
    <result column="UPDATE_DATE" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
    <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
    <result column="CC_ITEM_ID" property="ccItemId" jdbcType="VARCHAR" />
    <result column="APPROVAL_STATUS" property="approvalStatus" jdbcType="INTEGER" />
    
     <result column="NATURE" property="nature" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    ITEM_ID, STRUCT_ID, ENFORCESTATE, ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, WK_DATE, OTHER_UNIT, 
    ITEM_MONEY, START_DATE, END_DATE, FUND_SOURCE, JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
    ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, ITEM_CITY, 
    LOGIN_MANAGER, FIRE_GRADE, QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, BORDER_GRADE, IS_FLOOR, 
    PIT_GRADE, BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, BASEMENT_FLOOR, STRUCTURE_FLOOR, 
    BUILDING_HIGHT, SPAN, IS_DEL, CREATE_DATE, CREATE_BY, UPDATE_DATE, UPDATE_BY, APPROVAL_STATUS,CC_ITEM_ID,NATURE
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from tt_iteminfo
    where ITEM_ID = #{itemId,jdbcType=VARCHAR}
  </select>
  
  <select id="listPageItemAllByStructId" parameterType="page" resultType="pd" useCache="false">
  select 
  ITEM_ID,
  (SELECT DISTINCT 
    item_id 
  FROM
    `tt_item_person` 
  WHERE tt_item_person.`ITEM_ID` = tt_iteminfo.`ITEM_ID` 
    AND user_id = #{pd.USER_ID}) AS ENTER,
  (SELECT 
    s.`STRUCT_NAME` 
  FROM
    sys_structinfo s 
  WHERE s.`STRUCT_ID` = tt_iteminfo.`STRUCT_ID`) AS STRUCT_NAME,
  ENFORCESTATE,
  STRUCT_ID,
  (SELECT 
    STRUCTST_AGE 
  FROM
    sys_structinfo i 
  WHERE i.STRUCT_ID = tt_iteminfo.`STRUCT_ID`) AS STRUCTST_AGE,
  ITEM_NUMBER,
  ITEM_NAME,
  (SELECT 
    d.`NAME` 
  FROM
    sys_dictionaries d 
  WHERE d.`BIANMA` = ITEM_TYPE) ITEM_TYPE,
  WK_DATE,
  OTHER_UNIT,
  ITEM_MONEY,
  START_DATE,
  END_DATE,
  FUND_SOURCE,
  (SELECT 
    NAME 
  FROM
    sys_dictionaries 
  WHERE BIANMA = tt_iteminfo.JOB_FORMAT) AS JOB_FORMAT,
  DETAILS_ADDRESS,
  ITEMEA_RMARK,
  ITEMZD_AREA,
  ITEMDX_AREA,
  ITEM_AREA,
  ITEM_MASS,
  ITEM_DEPICT,
  (SELECT 
    NAME 
  FROM
    sys_dictionaries 
  WHERE BIANMA = tt_iteminfo.ITEM_PROVINCE) AS ITEM_PROVINCE,
  (SELECT 
    a.NAME 
  FROM
    `sys_dictionaries` a 
  WHERE a.BIANMA = tt_iteminfo.ITEM_CITY) AS ITEM_CITY,
  LOGIN_MANAGER,
  FIRE_GRADE,
  QUAKE_GRADE,
  IS_CURTAIN,
  BASIC_DESIGN,
  BORDER_GRADE,
  IS_FLOOR,
  PIT_GRADE,
  BIANPO_HIGHT,
  JIEGOU_SHAPE,
  PIT_SHENDU,
  BASEMENT_FLOOR,
  STRUCTURE_FLOOR,
  BUILDING_HIGHT,
  SPAN,
  IS_DEL,
  CREATE_DATE,
  CREATE_BY,
  UPDATE_DATE,
  UPDATE_BY,
  IFNULL(
    (SELECT 
      tt.APPROVAL_STATUS 
    FROM
      `tt_item_struct` tt 
    WHERE tt.struct_id = #{pd.STRUCT_ID}
      AND tt.item_id = tt_iteminfo.ITEM_ID),
    APPROVAL_STATUS
  ) AS APPROVAL_STATUS,
  APPROVAL_STATUS AS ITEM_STATUS,
  (SELECT 
    m.`STRUCTST_AGE` 
  FROM
    `sys_structinfo` m 
  WHERE m.`STRUCT_ID` =#{pd.STRUCT_ID}) AS AGE 
  FROM
  tt_iteminfo 
WHERE  `STRUCT_ID`=#{pd.STRUCT_ID}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from tt_iteminfo
    where ITEM_ID = #{itemId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert"  parameterType="pd" flushCache="false" >
    insert into tt_iteminfo (ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS)
    values (#{itemId,jdbcType=VARCHAR}, #{structId,jdbcType=VARCHAR}, #{enforcestate,jdbcType=INTEGER}, 
      #{itemNumber,jdbcType=VARCHAR}, #{itemName,jdbcType=VARCHAR}, #{itemType,jdbcType=CHAR}, 
      #{wkDate,jdbcType=INTEGER}, #{otherUnit,jdbcType=VARCHAR}, #{itemMoney,jdbcType=DECIMAL}, 
      #{startDate,jdbcType=DATE}, #{endDate,jdbcType=DATE}, #{fundSource,jdbcType=VARCHAR}, 
      #{jobFormat,jdbcType=VARCHAR}, #{detailsAddress,jdbcType=VARCHAR}, #{itemeaRmark,jdbcType=VARCHAR}, 
      #{itemzdArea,jdbcType=VARCHAR}, #{itemdxArea,jdbcType=VARCHAR}, #{itemArea,jdbcType=VARCHAR}, 
      #{itemMass,jdbcType=VARCHAR}, #{itemDepict,jdbcType=VARCHAR}, #{itemProvince,jdbcType=CHAR}, 
      #{itemCity,jdbcType=CHAR}, #{loginManager,jdbcType=VARCHAR}, #{fireGrade,jdbcType=CHAR}, 
      #{quakeGrade,jdbcType=CHAR}, #{isCurtain,jdbcType=CHAR}, #{basicDesign,jdbcType=CHAR}, 
      #{borderGrade,jdbcType=CHAR}, #{isFloor,jdbcType=INTEGER}, #{pitGrade,jdbcType=CHAR}, 
      #{bianpoHight,jdbcType=DECIMAL}, #{jiegouShape,jdbcType=CHAR}, #{pitShendu,jdbcType=DECIMAL}, 
      #{basementFloor,jdbcType=INTEGER}, #{structureFloor,jdbcType=INTEGER}, #{buildingHight,jdbcType=DECIMAL}, 
      #{span,jdbcType=DECIMAL}, #{isDel,jdbcType=INTEGER}, #{createDate,jdbcType=TIMESTAMP}, 
      #{createBy,jdbcType=VARCHAR}, #{updateDate,jdbcType=TIMESTAMP}, #{updateBy,jdbcType=VARCHAR}, 
      #{approvalStatus,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="pd" flushCache="false" >
    insert into tt_iteminfo
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="itemId != null" >
        ITEM_ID,
      </if>
      <if test="structId != null" >
        STRUCT_ID,
      </if>
      <if test="enforcestate != null" >
        ENFORCESTATE,
      </if>
      <if test="itemNumber != null" >
        ITEM_NUMBER,
      </if>
      <if test="itemName != null" >
        ITEM_NAME,
      </if>
      <if test="itemType != null" >
        ITEM_TYPE,
      </if>
      <if test="wkDate != null" >
        WK_DATE,
      </if>
      <if test="otherUnit != null" >
        OTHER_UNIT,
      </if>
      <if test="itemMoney != null" >
        ITEM_MONEY,
      </if>
      <if test="startDate != null" >
        START_DATE,
      </if>
      <if test="endDate != null" >
        END_DATE,
      </if>
      <if test="fundSource != null" >
        FUND_SOURCE,
      </if>
      <if test="jobFormat != null" >
        JOB_FORMAT,
      </if>
      <if test="detailsAddress != null" >
        DETAILS_ADDRESS,
      </if>
      <if test="itemeaRmark != null" >
        ITEMEA_RMARK,
      </if>
      <if test="itemzdArea != null" >
        ITEMZD_AREA,
      </if>
      <if test="itemdxArea != null" >
        ITEMDX_AREA,
      </if>
      <if test="itemArea != null" >
        ITEM_AREA,
      </if>
      <if test="itemMass != null" >
        ITEM_MASS,
      </if>
      <if test="itemDepict != null" >
        ITEM_DEPICT,
      </if>
      <if test="itemProvince != null" >
        ITEM_PROVINCE,
      </if>
      <if test="itemCity != null" >
        ITEM_CITY,
      </if>
      <if test="loginManager != null" >
        LOGIN_MANAGER,
      </if>
      <if test="fireGrade != null" >
        FIRE_GRADE,
      </if>
      <if test="quakeGrade != null" >
        QUAKE_GRADE,
      </if>
      <if test="isCurtain != null" >
        IS_CURTAIN,
      </if>
      <if test="basicDesign != null" >
        BASIC_DESIGN,
      </if>
      <if test="borderGrade != null" >
        BORDER_GRADE,
      </if>
      <if test="isFloor != null" >
        IS_FLOOR,
      </if>
      <if test="pitGrade != null" >
        PIT_GRADE,
      </if>
      <if test="bianpoHight != null" >
        BIANPO_HIGHT,
      </if>
      <if test="jiegouShape != null" >
        JIEGOU_SHAPE,
      </if>
      <if test="pitShendu != null" >
        PIT_SHENDU,
      </if>
      <if test="basementFloor != null" >
        BASEMENT_FLOOR,
      </if>
      <if test="structureFloor != null" >
        STRUCTURE_FLOOR,
      </if>
      <if test="buildingHight != null" >
        BUILDING_HIGHT,
      </if>
      <if test="span != null" >
        SPAN,
      </if>
      <if test="isDel != null" >
        IS_DEL,
      </if>
      <if test="createDate != null" >
        CREATE_DATE,
      </if>
      <if test="createBy != null" >
        CREATE_BY,
      </if>
      <if test="updateDate != null" >
        UPDATE_DATE,
      </if>
      <if test="updateBy != null" >
        UPDATE_BY,
      </if>
      <if test="approvalStatus != null" >
        APPROVAL_STATUS,
      </if>
      
      
       <if test="identifyNumber != null" >
        IDENTIFY_NUMBER,
      </if>
       <if test="otherAddress != null" >
        OTHER_ADDRESS,
      </if>
       <if test="otherPhone != null" >
        OTHER_PHONE,
      </if>
       <if test="otherNumber != null" >
        OTHER_NUMBER,
      </if>
       <if test="taxationType != null" >
        TAXATION_TYPE,
      </if>
         <if test="nature != null" >
        NATURE,
      </if>
      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="itemId != null" >
        #{itemId,jdbcType=VARCHAR},
      </if>
      <if test="structId != null" >
        #{structId,jdbcType=VARCHAR},
      </if>
      <if test="enforcestate != null" >
        #{enforcestate,jdbcType=INTEGER},
      </if>
      <if test="itemNumber != null" >
        #{itemNumber,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null" >
        #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="itemType != null" >
        #{itemType,jdbcType=CHAR},
      </if>
      <if test="wkDate != null" >
        #{wkDate,jdbcType=INTEGER},
      </if>
      <if test="otherUnit != null" >
        #{otherUnit,jdbcType=VARCHAR},
      </if>
      <if test="itemMoney != null" >
        #{itemMoney,jdbcType=DECIMAL},
      </if>
      <if test="startDate != null" >
        #{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null" >
        #{endDate,jdbcType=DATE},
      </if>
      <if test="fundSource != null" >
        #{fundSource,jdbcType=VARCHAR},
      </if>
      <if test="jobFormat != null" >
        #{jobFormat,jdbcType=VARCHAR},
      </if>
      <if test="detailsAddress != null" >
        #{detailsAddress,jdbcType=VARCHAR},
      </if>
      <if test="itemeaRmark != null" >
        #{itemeaRmark,jdbcType=VARCHAR},
      </if>
      <if test="itemzdArea != null" >
        #{itemzdArea,jdbcType=VARCHAR},
      </if>
      <if test="itemdxArea != null" >
        #{itemdxArea,jdbcType=VARCHAR},
      </if>
      <if test="itemArea != null" >
        #{itemArea,jdbcType=VARCHAR},
      </if>
      <if test="itemMass != null" >
        #{itemMass,jdbcType=VARCHAR},
      </if>
      <if test="itemDepict != null" >
        #{itemDepict,jdbcType=VARCHAR},
      </if>
      <if test="itemProvince != null" >
        #{itemProvince,jdbcType=CHAR},
      </if>
      <if test="itemCity != null" >
        #{itemCity,jdbcType=CHAR},
      </if>
      <if test="loginManager != null" >
        #{loginManager,jdbcType=VARCHAR},
      </if>
      <if test="fireGrade != null" >
        #{fireGrade,jdbcType=CHAR},
      </if>
      <if test="quakeGrade != null" >
        #{quakeGrade,jdbcType=CHAR},
      </if>
      <if test="isCurtain != null" >
        #{isCurtain,jdbcType=CHAR},
      </if>
      <if test="basicDesign != null" >
        #{basicDesign,jdbcType=CHAR},
      </if>
      <if test="borderGrade != null" >
        #{borderGrade,jdbcType=CHAR},
      </if>
      <if test="isFloor != null" >
        #{isFloor,jdbcType=INTEGER},
      </if>
      <if test="pitGrade != null" >
        #{pitGrade,jdbcType=CHAR},
      </if>
      <if test="bianpoHight != null" >
        #{bianpoHight,jdbcType=DECIMAL},
      </if>
      <if test="jiegouShape != null" >
        #{jiegouShape,jdbcType=CHAR},
      </if>
      <if test="pitShendu != null" >
        #{pitShendu,jdbcType=DECIMAL},
      </if>
      <if test="basementFloor != null" >
        #{basementFloor,jdbcType=INTEGER},
      </if>
      <if test="structureFloor != null" >
        #{structureFloor,jdbcType=INTEGER},
      </if>
      <if test="buildingHight != null" >
        #{buildingHight,jdbcType=DECIMAL},
      </if>
      <if test="span != null" >
        #{span,jdbcType=DECIMAL},
      </if>
      <if test="isDel != null" >
        #{isDel,jdbcType=INTEGER},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null" >
        #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        #{updateBy,jdbcType=VARCHAR},
      </if>
      <if test="approvalStatus != null" >
        #{approvalStatus,jdbcType=INTEGER},
      </if>
      
        <if test="identifyNumber != null" >
         #{identifyNumber,jdbcType=VARCHAR},
      </if>
       <if test="otherAddress != null" >
        #{otherAddress,jdbcType=VARCHAR},
      </if>
       <if test="otherPhone != null" >
         #{otherPhone,jdbcType=VARCHAR},
      </if>
       <if test="otherNumber != null" >
        #{otherNumber,jdbcType=VARCHAR},
      </if>
       <if test="taxationType != null" >
        #{taxationType},
      </if>
       <if test="nature != null" >
        #{nature},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="pd" >
    update tt_iteminfo
    <set >
      <if test="structId != null" >
        STRUCT_ID = #{structId,jdbcType=VARCHAR},
      </if>
      <if test="enforcestate != null" >
        ENFORCESTATE = #{enforcestate,jdbcType=INTEGER},
      </if>
      <if test="itemNumber != null" >
        ITEM_NUMBER = #{itemNumber,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null" >
        ITEM_NAME = #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="itemType != null" >
        ITEM_TYPE = #{itemType,jdbcType=CHAR},
      </if>
      <if test="wkDate != null" >
        WK_DATE = #{wkDate,jdbcType=INTEGER},
      </if>
      <if test="otherUnit != null" >
        OTHER_UNIT = #{otherUnit,jdbcType=VARCHAR},
      </if>
      <if test="itemMoney != null" >
        ITEM_MONEY = #{itemMoney,jdbcType=DECIMAL},
      </if>
      <if test="startDate != null" >
        START_DATE = #{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null" >
        END_DATE = #{endDate,jdbcType=DATE},
      </if>
      <if test="fundSource != null" >
        FUND_SOURCE = #{fundSource,jdbcType=VARCHAR},
      </if>
      <if test="jobFormat != null" >
        JOB_FORMAT = #{jobFormat,jdbcType=VARCHAR},
      </if>
      <if test="detailsAddress != null" >
        DETAILS_ADDRESS = #{detailsAddress,jdbcType=VARCHAR},
      </if>
      <if test="itemeaRmark != null" >
        ITEMEA_RMARK = #{itemeaRmark,jdbcType=VARCHAR},
      </if>
      <if test="itemzdArea != null" >
        ITEMZD_AREA = #{itemzdArea,jdbcType=VARCHAR},
      </if>
      <if test="itemdxArea != null" >
        ITEMDX_AREA = #{itemdxArea,jdbcType=VARCHAR},
      </if>
      <if test="itemArea != null" >
        ITEM_AREA = #{itemArea,jdbcType=VARCHAR},
      </if>
      <if test="itemMass != null" >
        ITEM_MASS = #{itemMass,jdbcType=VARCHAR},
      </if>
      <if test="itemDepict != null" >
        ITEM_DEPICT = #{itemDepict,jdbcType=VARCHAR},
      </if>
      <if test="itemProvince != null" >
        ITEM_PROVINCE = #{itemProvince,jdbcType=CHAR},
      </if>
      <if test="itemCity != null" >
        ITEM_CITY = #{itemCity,jdbcType=CHAR},
      </if>
      <if test="loginManager != null" >
        LOGIN_MANAGER = #{loginManager,jdbcType=VARCHAR},
      </if>
      <if test="fireGrade != null" >
        FIRE_GRADE = #{fireGrade,jdbcType=CHAR},
      </if>
      <if test="quakeGrade != null" >
        QUAKE_GRADE = #{quakeGrade,jdbcType=CHAR},
      </if>
      <if test="isCurtain != null" >
        IS_CURTAIN = #{isCurtain,jdbcType=CHAR},
      </if>
      <if test="basicDesign != null" >
        BASIC_DESIGN = #{basicDesign,jdbcType=CHAR},
      </if>
      <if test="borderGrade != null" >
        BORDER_GRADE = #{borderGrade,jdbcType=CHAR},
      </if>
      <if test="isFloor != null" >
        IS_FLOOR = #{isFloor,jdbcType=INTEGER},
      </if>
      <if test="pitGrade != null" >
        PIT_GRADE = #{pitGrade,jdbcType=CHAR},
      </if>
      <if test="bianpoHight != null" >
        BIANPO_HIGHT = #{bianpoHight,jdbcType=DECIMAL},
      </if>
      <if test="jiegouShape != null" >
        JIEGOU_SHAPE = #{jiegouShape,jdbcType=CHAR},
      </if>
      <if test="pitShendu != null" >
        PIT_SHENDU = #{pitShendu,jdbcType=DECIMAL},
      </if>
      <if test="basementFloor != null" >
        BASEMENT_FLOOR = #{basementFloor,jdbcType=INTEGER},
      </if>
      <if test="structureFloor != null" >
        STRUCTURE_FLOOR = #{structureFloor,jdbcType=INTEGER},
      </if>
      <if test="buildingHight != null" >
        BUILDING_HIGHT = #{buildingHight,jdbcType=DECIMAL},
      </if>
      <if test="span != null" >
        SPAN = #{span,jdbcType=DECIMAL},
      </if>
      <if test="isDel != null" >
        IS_DEL = #{isDel,jdbcType=INTEGER},
      </if>
      <if test="createDate != null" >
        CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null" >
        CREATE_BY = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        UPDATE_BY = #{updateBy,jdbcType=VARCHAR},
      </if>
      <if test="approvalStatus != null" >
        APPROVAL_STATUS = #{approvalStatus,jdbcType=INTEGER},
      </if>
      <if test="ccItemId != null" >
        CC_ITEM_ID = #{ccItemId,jdbcType=INTEGER},
      </if>
      
        <if test="identifyNumber != null" >
      IDENTIFY_NUMBER=   #{identifyNumber,jdbcType=VARCHAR},
      </if>
       <if test="otherAddress != null" >
      OTHER_ADDRESS=  #{otherAddress,jdbcType=VARCHAR},
      </if>
       <if test="otherPhone != null" >
        OTHER_PHONE= #{otherPhone,jdbcType=VARCHAR},
      </if>
       <if test="otherNumber != null" >
       OTHER_NUMBER= #{otherNumber,jdbcType=VARCHAR},
      </if>
       <if test="taxationType != null" >
        TAXATION_TYPE=#{taxationType},
      </if>
      <if test="nature != null" >
        NATURE=#{nature},
      </if>
      
    </set>
    where ITEM_ID = #{itemId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.ssc.entity.system.TtIteminfo" >
    update tt_iteminfo
    set STRUCT_ID = #{structId,jdbcType=VARCHAR},
      ENFORCESTATE = #{enforcestate,jdbcType=INTEGER},
      ITEM_NUMBER = #{itemNumber,jdbcType=VARCHAR},
      ITEM_NAME = #{itemName,jdbcType=VARCHAR},
      ITEM_TYPE = #{itemType,jdbcType=CHAR},
      WK_DATE = #{wkDate,jdbcType=INTEGER},
      OTHER_UNIT = #{otherUnit,jdbcType=VARCHAR},
      ITEM_MONEY = #{itemMoney,jdbcType=DECIMAL},
      START_DATE = #{startDate,jdbcType=DATE},
      END_DATE = #{endDate,jdbcType=DATE},
      FUND_SOURCE = #{fundSource,jdbcType=VARCHAR},
      JOB_FORMAT = #{jobFormat,jdbcType=VARCHAR},
      DETAILS_ADDRESS = #{detailsAddress,jdbcType=VARCHAR},
      ITEMEA_RMARK = #{itemeaRmark,jdbcType=VARCHAR},
      ITEMZD_AREA = #{itemzdArea,jdbcType=VARCHAR},
      ITEMDX_AREA = #{itemdxArea,jdbcType=VARCHAR},
      ITEM_AREA = #{itemArea,jdbcType=VARCHAR},
      ITEM_MASS = #{itemMass,jdbcType=VARCHAR},
      ITEM_DEPICT = #{itemDepict,jdbcType=VARCHAR},
      ITEM_PROVINCE = #{itemProvince,jdbcType=CHAR},
      ITEM_CITY = #{itemCity,jdbcType=CHAR},
      LOGIN_MANAGER = #{loginManager,jdbcType=VARCHAR},
      FIRE_GRADE = #{fireGrade,jdbcType=CHAR},
      QUAKE_GRADE = #{quakeGrade,jdbcType=CHAR},
      IS_CURTAIN = #{isCurtain,jdbcType=CHAR},
      BASIC_DESIGN = #{basicDesign,jdbcType=CHAR},
      BORDER_GRADE = #{borderGrade,jdbcType=CHAR},
      IS_FLOOR = #{isFloor,jdbcType=INTEGER},
      PIT_GRADE = #{pitGrade,jdbcType=CHAR},
      BIANPO_HIGHT = #{bianpoHight,jdbcType=DECIMAL},
      JIEGOU_SHAPE = #{jiegouShape,jdbcType=CHAR},
      PIT_SHENDU = #{pitShendu,jdbcType=DECIMAL},
      BASEMENT_FLOOR = #{basementFloor,jdbcType=INTEGER},
      STRUCTURE_FLOOR = #{structureFloor,jdbcType=INTEGER},
      BUILDING_HIGHT = #{buildingHight,jdbcType=DECIMAL},
      SPAN = #{span,jdbcType=DECIMAL},
      IS_DEL = #{isDel,jdbcType=INTEGER},
      CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
      CREATE_BY = #{createBy,jdbcType=VARCHAR},
      UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
      UPDATE_BY = #{updateBy,jdbcType=VARCHAR},
      APPROVAL_STATUS = #{approvalStatus,jdbcType=INTEGER}
    where ITEM_ID = #{itemId,jdbcType=VARCHAR}
  </update>
  
   <!-- 查询审批详情 -->
	   <select id="findPurchaseDeclareManageByDeclareId" resultMap="BaseResultMap" parameterType="pd" >
	    select 
	     PURCHASE_DECLARE_ID, PURCHASE_ID, DECLARE_NO, DECLARE_NUM, DECLARE_PRICE, DECLARE_AMOUNT, 
	    (SELECT i.`ITEM_NAME` FROM `tt_iteminfo` i WHERE i.`ITEM_ID`=t.ITEM_ID) as ITEM_ID
	    , DECLARE_REMARK, INSTRUCTIONS_NUM, INSTRUCTIONS_PRICE, INSTRUCTIONS_AOMUNT, 
	    INSTRUCTIONS_REMARK,(SELECT u.`NAME` FROM `sys_user` u WHERE u.`USER_ID`=t.INSTRUCTIONS_USER) as  INSTRUCTIONS_USER, INSTRUCTIONS_DATE, DECLARE_STATE, IS_DEL, 
	    CREATE_DATE,
	    (SELECT u.`NAME` FROM `sys_user` u WHERE u.`USER_ID`=t.CREATE_BY) as 
	     CREATE_BY, UPDATE_DATE, UPDATE_BY
	    from tt_iteminfo t
	    where PURCHASE_DECLARE_ID = #{purchaseDeclareId,jdbcType=VARCHAR}
  </select>
  
    <!-- 通过struct_id获取项目列表数据 -->
	<select id="listPageAllItemStructid" parameterType="page" resultType="pd" useCache="false">
	SELECT 
			ITEM_ID, (SELECT s.`STRUCT_NAME` FROM sys_structinfo s WHERE s.`STRUCT_ID`=t.`STRUCT_ID`)AS STRUCT_NAME, ENFORCESTATE,STRUCT_ID, 
      ITEM_NUMBER, ITEM_NAME,
      (SELECT d.`NAME` FROM sys_dictionaries  d WHERE d.`BIANMA` = ITEM_TYPE )  ITEM_TYPE,
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, (SELECT NAME FROM sys_dictionaries WHERE BIANMA=t.JOB_FORMAT) AS JOB_FORMAT
      , DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT,(SELECT NAME FROM sys_dictionaries WHERE BIANMA=t.ITEM_PROVINCE) AS ITEM_PROVINCE , 
      (SELECT a.NAME FROM `sys_dictionaries` a  WHERE a.BIANMA =t.ITEM_CITY) AS ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      (SELECT m.`STRUCTST_AGE` FROM `sys_structinfo` m WHERE m.`STRUCT_ID`=#{pd.STRUCT_ID})as AGE,
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY,UPDATE_DATE, UPDATE_BY, 
      (SELECT tt.APPROVAL_STATUS FROM `tt_item_struct` tt WHERE tt.struct_id=#{pd.STRUCT_ID} AND tt.item_id=t.ITEM_ID) AS APPROVAL_STATUS,
      APPROVAL_STATUS AS ITEM_STATUS
		FROM 
			tt_iteminfo t
		WHERE STRUCT_ID=#{pd.STRUCT_ID} and IS_DEL=0 
		<if test="pd.ITEMCOLLECTTYPE==null or pd.ITEMCOLLECTTYPE == '' ">
		 	and (APPROVAL_STATUS = 1)
		</if>
		
		<if test="pd.ITEMNAME != null and pd.ITEMNAME != ''"><!-- 关键词检索 -->
			and
				(
					 ITEM_NAME LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%')
					 or 
					 ITEM_NUMBER LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%') 
				)
		</if>
		<if test="pd.ITEMCOLLECTTYPE!=null and pd.ITEMCOLLECTTYPE != ''   and pd.ITEMCOLLECTTYPE !=3"><!-- 审批状态检索 -->
		 	and (APPROVAL_STATUS = #{pd.ITEMCOLLECTTYPE})
		</if>
	</select>
	
	<!-- 微信端获取项目列表数据 -->
	<select id="findIteminfoWeixin" parameterType="pd" resultType="pd" useCache="false">
		select 
			ITEM_ID,
			 (  SELECT     COUNT(tt_item_person.`ITEM_PERSON_ID`)  FROM    `tt_item_person`     LEFT JOIN `sys_role` 
      ON tt_item_person.`ROLE_ID` = sys_role.`ROLE_ID`   WHERE tt_item_person.item_id = tt_iteminfo.ITEM_ID 
    AND sys_role.`ROLE_CODE` IN ('X_001', 'X_003', 'X_005', 'X_004')     AND tt_item_person.user_id = #{USER_ID}) AS ISVIEW ,
			(SELECT DISTINCT item_id FROM `tt_item_person` WHERE tt_item_person.`ITEM_ID`= tt_iteminfo.`ITEM_ID` AND 
	user_id =#{USER_ID}  ) AS ENTER,
			 (SELECT s.`STRUCT_NAME` FROM sys_structinfo s WHERE s.`STRUCT_ID`=tt_iteminfo.`STRUCT_ID`)AS STRUCT_NAME, ENFORCESTATE,STRUCT_ID, 
			 (SELECT STRUCTST_AGE FROM sys_structinfo i WHERE i.STRUCT_ID=tt_iteminfo.`STRUCT_ID`) AS STRUCTST_AGE,
      ITEM_NUMBER, ITEM_NAME,
      (SELECT d.`NAME` FROM sys_dictionaries  d WHERE d.`BIANMA` = ITEM_TYPE )  ITEM_TYPE,
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.JOB_FORMAT) AS JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT,(SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_PROVINCE) AS ITEM_PROVINCE , 
      (SELECT a.NAME FROM `sys_dictionaries` a  WHERE a.BIANMA =tt_iteminfo.ITEM_CITY) AS ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, (SELECT NAME FROM `sys_user` WHERE user_id = tt_iteminfo.CREATE_BY) AS CREATE_NAME,
      CREATE_BY, UPDATE_DATE, UPDATE_BY,
       IFNULL((SELECT tt.APPROVAL_STATUS FROM `tt_item_struct` tt WHERE tt.struct_id=#{STRUCT_ID} AND tt.item_id=tt_iteminfo.ITEM_ID),APPROVAL_STATUS) AS APPROVAL_STATUS,
      APPROVAL_STATUS AS ITEM_STATUS,
      (SELECT m.`STRUCTST_AGE` FROM `sys_structinfo` m WHERE m.`STRUCT_ID`=#{STRUCT_ID})AS AGE
		from  
			tt_iteminfo 
		WHERE (item_id IN ( SELECT t.`ITEM_ID` FROM tt_item_struct t WHERE t.`STRUCT_ID`=#{STRUCT_ID}  ) OR STRUCT_ID= #{STRUCT_ID} ) and IS_DEL=0 
		and (APPROVAL_STATUS = 1) 
		 
		<if test="itemType == 3 ">
		and (ENFORCESTATE = 0)
		</if>
		<if test="itemType == 4 ">
		and (ENFORCESTATE = 1)
		</if>
		<if test="itemType == 5 ">
		and (ENFORCESTATE = 2)
		</if>
		<if test="itemType == 6 ">
		and (ENFORCESTATE = 3)
		</if>
		<if test="itemType == 7 ">
		and (ENFORCESTATE = 4)
		</if>
		
		<if test="BIANMA != null and BIANMA != ''  ">
		and (ITEM_PROVINCE = #{BIANMA})
		</if>
		
		order by CREATE_DATE desc
	</select>
	
	
	<!-- 子公司通过struct_id获取项目列表数据 -->
	<select id="listAllItemStructid" parameterType="page" resultType="pd" useCache="false">
		select 
			ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME,
      (SELECT d.`NAME` FROM sys_dictionaries  d WHERE d.`BIANMA` = ITEM_TYPE )  ITEM_TYPE,
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS
		from 
			tt_iteminfo
		where STRUCT_ID=#{pd.STRUCT_ID} and IS_DEL=0
		
		<if test="pd.ITEMNAME != null and pd.ITEMNAME != ''"><!-- 关键词检索 -->
			and
				(
					 ITEM_NAME LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%')
					 or 
					 ITEM_NUMBER LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%') 
				)
		</if>
		<if test="pd.ITEMCOLLECTTYPE!=null and pd.ITEMCOLLECTTYPE != ''   and pd.ITEMCOLLECTTYPE !=3"><!-- 审批状态检索 -->
		 	and (APPROVAL_STATUS = #{pd.ITEMCOLLECTTYPE})
		</if>
		order by CREATE_DATE desc
	</select>
	
	
	
	<!-- 集团公式和区域公司查询项目列表 SHUIPIAO -->
	<select id="listPageAllItemByItemStructidSHUIPIAO" parameterType="page" resultType="pd" useCache="false">
		select 
			ITEM_ID, (SELECT s.`STRUCT_NAME` FROM sys_structinfo s WHERE s.`STRUCT_ID`=tt_iteminfo.`STRUCT_ID`)AS STRUCT_NAME, ENFORCESTATE,STRUCT_ID, 
			 (SELECT STRUCTST_AGE FROM sys_structinfo i WHERE i.STRUCT_ID=tt_iteminfo.`STRUCT_ID`) AS STRUCTST_AGE,
      ITEM_NUMBER, ITEM_NAME,
      (SELECT d.`NAME` FROM sys_dictionaries  d WHERE d.`BIANMA` = ITEM_TYPE )  ITEM_TYPE,
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.JOB_FORMAT) AS JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT,(SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_PROVINCE) AS ITEM_PROVINCE , 
      (SELECT a.NAME FROM `sys_dictionaries` a  WHERE a.BIANMA =tt_iteminfo.ITEM_CITY) AS ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY,TAXATION_TYPE,
      (SELECT tt.APPROVAL_STATUS FROM `tt_item_struct` tt WHERE tt.struct_id=#{pd.STRUCT_ID} AND tt.item_id=tt_iteminfo.ITEM_ID) AS APPROVAL_STATUS,
      APPROVAL_STATUS AS ITEM_STATUS,
      (SELECT m.`STRUCTST_AGE` FROM `sys_structinfo` m WHERE m.`STRUCT_ID`=#{pd.STRUCT_ID})AS AGE
		from 
			tt_iteminfo 
		WHERE (item_id IN ( SELECT t.`ITEM_ID` FROM tt_item_struct t WHERE t.`STRUCT_ID`=#{pd.STRUCT_ID}  ) OR STRUCT_ID= #{pd.STRUCT_ID} ) and IS_DEL=0 
		<if test="pd.ITEMCOLLECTTYPE==null or pd.ITEMCOLLECTTYPE == ''  or pd.ITEMCOLLECTTYPE == 3">
		 	and (APPROVAL_STATUS = 1)
		</if>
		<if test="pd.ITEMNAME != null and pd.ITEMNAME != ''"><!-- 关键词检索 -->
			and
				(
					 ITEM_NAME LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%')
					 or 
					 ITEM_NUMBER LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%') 
				)
		</if>
		
		<if test="pd.ITEMCOLLECTTYPE!=null and pd.ITEMCOLLECTTYPE != ''   and pd.ITEMCOLLECTTYPE !=3">
		 	and (APPROVAL_STATUS = #{pd.ITEMCOLLECTTYPE})
		</if>
		order by CREATE_DATE desc
	</select>
	
	
		<!-- 查询项目列表 -->
	<select id="listPageAllItemByItemStructid" parameterType="page" resultType="pd" useCache="false">
		select 
			tt_iteminfo.ITEM_ID,(SELECT DISTINCT item_id FROM `tt_item_person` WHERE tt_item_person.`ITEM_ID`= tt_iteminfo.`ITEM_ID` AND 
	user_id =#{pd.USER_ID}  ) AS ENTER ,
		(SELECT ROLE_ID FROM `sys_role` WHERE ROLE_CODE ='L_34' AND STRUCT_ID=(SELECT STRUCT_ID FROM `sys_user` WHERE USER_ID=#{pd.USER_ID} )
	AND sys_role.`ROLE_ID` IN (SELECT sys_user_role.`ROLE_ID` FROM  `sys_user_role` LEFT JOIN `sys_role` ON sys_user_role.`ROLE_ID`= `sys_role`.`ROLE_ID` 
	WHERE sys_user_role.user_id=#{pd.USER_ID} ) ) as ENTER2,
	(SELECT 
            s.`STRUCT_NAME` 
          FROM
            sys_structinfo s 
          WHERE s.`STRUCT_ID` = tt_iteminfo.`STRUCT_ID`) AS STRUCT_NAME,
          tt_iteminfo.ENFORCESTATE,
          tt_iteminfo.STRUCT_ID,
          (SELECT 
            STRUCTST_AGE 
          FROM
            sys_structinfo i 
          WHERE i.STRUCT_ID = tt_iteminfo.`STRUCT_ID`) AS STRUCTST_AGE,
          tt_iteminfo.ITEM_NUMBER,
          tt_iteminfo.ITEM_NAME,
          (SELECT 
            d.`NAME` 
          FROM
            sys_dictionaries d 
          WHERE d.`BIANMA` = ITEM_TYPE) ITEM_TYPE,
          tt_iteminfo.WK_DATE,
          tt_iteminfo.OTHER_UNIT,
          tt_iteminfo.ITEM_MONEY,
          tt_iteminfo.START_DATE,
          tt_iteminfo.END_DATE,
          tt_iteminfo.FUND_SOURCE,
          (SELECT 
            NAME 
          FROM
            sys_dictionaries 
          WHERE BIANMA = tt_iteminfo.JOB_FORMAT) AS JOB_FORMAT,
          tt_iteminfo.DETAILS_ADDRESS,
          tt_iteminfo.ITEMEA_RMARK,
          tt_iteminfo.ITEMZD_AREA,
          tt_iteminfo.ITEMDX_AREA,
          tt_iteminfo.ITEM_AREA,
          tt_iteminfo.ITEM_MASS,
          tt_iteminfo.ITEM_DEPICT,
          (SELECT 
            NAME 
          FROM
            sys_dictionaries 
          WHERE BIANMA = tt_iteminfo.ITEM_PROVINCE) AS ITEM_PROVINCE,
          (SELECT 
            a.NAME 
          FROM
            `sys_dictionaries` a 
          WHERE a.BIANMA = tt_iteminfo.ITEM_CITY) AS ITEM_CITY,
          tt_iteminfo.LOGIN_MANAGER,
          tt_iteminfo.FIRE_GRADE,
          tt_iteminfo.QUAKE_GRADE,
          tt_iteminfo.IS_CURTAIN,
          tt_iteminfo.BASIC_DESIGN,
          tt_iteminfo.BORDER_GRADE,
          tt_iteminfo.IS_FLOOR,
          tt_iteminfo.PIT_GRADE,
          tt_iteminfo.BIANPO_HIGHT,
          tt_iteminfo.JIEGOU_SHAPE,
          tt_iteminfo.PIT_SHENDU,
          tt_iteminfo.BASEMENT_FLOOR,
          tt_iteminfo.STRUCTURE_FLOOR,
          tt_iteminfo.BUILDING_HIGHT,
          tt_iteminfo.TAXATION_TYPE,
          tt_iteminfo.SPAN,
          tt_iteminfo.IS_DEL,
          tt_iteminfo.CREATE_DATE,
          tt_iteminfo.CREATE_BY,
          tt_iteminfo.UPDATE_DATE,
          tt_iteminfo.UPDATE_BY,
       IFNULL((SELECT tt.APPROVAL_STATUS FROM `tt_item_struct` tt WHERE tt.struct_id=#{pd.STRUCT_ID} AND tt.item_id=tt_iteminfo.ITEM_ID),APPROVAL_STATUS) AS APPROVAL_STATUS,
      APPROVAL_STATUS AS ITEM_STATUS,
      (SELECT m.`STRUCTST_AGE` FROM `sys_structinfo` m WHERE m.`STRUCT_ID`=#{pd.STRUCT_ID})AS AGE,
      case
       when (SELECT COUNT(*) FROM tt_bill_apply tba WHERE tba.`ITEM_ID`=tt_iteminfo.ITEM_ID AND tba.`IS_DEL`=0 AND tba.`STATE`>=2)>0
       then 'yes'
       else 'no'
      end  hasBill
		from  
			tt_iteminfo LEFT JOIN `tt_project_pact` tp  ON tt_iteminfo.`ITEM_ID`=tp.`ITEM_ID` AND tp.`IS_DEL`=0
		WHERE 
		 1 = 1 
  AND (
    (SELECT  COUNT(1) FROM sys_user_role s WHERE s.`ROLE_ID` IN (SELECT su.`ROLE_ID` 
      FROM sys_role su WHERE su.`ROLE_CODE` LIKE 'L\_%') AND s.`USER_ID` = #{pd.USER_ID} ) > 0 
    OR 
    (SELECT COUNT(1) FROM tt_item_person tip WHERE tip.`ITEM_ID` = tt_iteminfo.`ITEM_ID`AND tip.`USER_ID` = #{pd.USER_ID} ) > 0
  )
		<if test="pd.PACTTYPE==0">
		 	 and tp.`PARENT_ID` IS   NULL 
			</if>
			<if test="pd.PACTTYPE==1">
		 	and tp.`PARENT_ID` IS NOT  NULL 
			</if>
		
		
		and (tt_iteminfo.item_id IN ( SELECT t.`ITEM_ID` FROM tt_item_struct t WHERE t.`STRUCT_ID`=#{pd.STRUCT_ID}  ) OR tt_iteminfo.STRUCT_ID= #{pd.STRUCT_ID} ) and tt_iteminfo.IS_DEL=0 
		<if test="pd.ITEMCOLLECTTYPE==null or pd.ITEMCOLLECTTYPE == ''  or pd.ITEMCOLLECTTYPE == 3">
		 	and (APPROVAL_STATUS = 1)
		</if>
		<if test="pd.ITEMNAME != null and pd.ITEMNAME != ''"><!-- 关键词检索 -->
			and
				(
					 tt_iteminfo.ITEM_NAME LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%')
					 or 
					 tt_iteminfo.ITEM_NUMBER LIKE CONCAT(CONCAT('%', #{pd.ITEMNAME}),'%') 
				)
		</if>
		
		<if test="pd.ITEMCOLLECTTYPE!=null and pd.ITEMCOLLECTTYPE != ''   and pd.ITEMCOLLECTTYPE !=3">
		 	and (tt_iteminfo.APPROVAL_STATUS = #{pd.ITEMCOLLECTTYPE})
		</if>
		order by tt_iteminfo.CREATE_DATE desc
	</select>
	
	
	<!-- 通过项目编号获取数据 -->
	<select id="hasItemNumber" parameterType="pd" resultType="pd" useCache="false">
		select 
			ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS
		from 
			tt_iteminfo
		where 
			STRUCT_ID=#{STRUCT_ID} and 
			ITEM_NUMBER = #{itemNumber} and IS_DEL=0
		<if test="ITEM_ID != null and ITEM_ID != ''">
			and ITEM_ID != #{ITEM_ID} 
		</if>
	</select>
	<!-- 通过项目名称获取数据 -->
	<select id="hasItemName" parameterType="pd" resultType="pd" useCache="false">
		select 
			ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS
		from 
			tt_iteminfo
		where 
			STRUCT_ID=#{STRUCT_ID} and 
			ITEM_NAME = #{itemName}  and IS_DEL=0
		<if test="ITEM_ID != null and ITEM_ID != ''">
			and ITEM_ID != #{ITEM_ID} 
		</if>
	</select>
	
	<!-- 通过user_id获取数据 -->
	<select id="findByItemById" parameterType="pd" resultType="pd" useCache="false">
		select 
			ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS,CC_ITEM_ID
      ,IDENTIFY_NUMBER,OTHER_ADDRESS,OTHER_PHONE,OTHER_NUMBER,TAXATION_TYPE
		from 
			tt_iteminfo
		where 
			ITEM_ID=#{ITEM_ID,jdbcType=VARCHAR}
	</select>
	
	<!-- 通过user_id获取数据 -->
	<select id="findByItemByIdAndCreateBy" parameterType="pd" resultType="pd" useCache="false">
		SELECT 
  ITEM_ID,
  (SELECT 
    s.`STRUCT_NAME` 
  FROM
    `sys_structinfo` s 
  WHERE s.`STRUCT_ID` = tt_iteminfo.STRUCT_ID) AS STRUCT_ID,
  ENFORCESTATE,
  ITEM_NUMBER,
  ITEM_NAME,
  ITEM_TYPE,
  WK_DATE,
  OTHER_UNIT,
  ITEM_MONEY,
  START_DATE,
  END_DATE,
  FUND_SOURCE,
  JOB_FORMAT,
  DETAILS_ADDRESS,
  ITEMEA_RMARK,
  ITEMZD_AREA,
  ITEMDX_AREA,
  ITEM_AREA,
  ITEM_MASS,
  ITEM_DEPICT,
  ITEM_PROVINCE,
  ITEM_CITY,
  LOGIN_MANAGER,
  FIRE_GRADE,
  QUAKE_GRADE,
  IS_CURTAIN,
  BASIC_DESIGN,
  BORDER_GRADE,
  IS_FLOOR,
  PIT_GRADE,
  BIANPO_HIGHT,
  JIEGOU_SHAPE,
  PIT_SHENDU,
  BASEMENT_FLOOR,
  STRUCTURE_FLOOR,
  BUILDING_HIGHT,
  SPAN,
  IS_DEL,
  CREATE_DATE,
  (SELECT 
    u.`NAME` 
  FROM
    `sys_user` u 
  WHERE u.`USER_ID` = tt_iteminfo.CREATE_BY) AS CREATE_BY,
  UPDATE_DATE,
  UPDATE_BY,
  APPROVAL_STATUS,
  CC_ITEM_ID,
  IDENTIFY_NUMBER,
  OTHER_ADDRESS,
  OTHER_PHONE,
  OTHER_NUMBER,
  TAXATION_TYPE 
FROM
  tt_iteminfo
		where 
			ITEM_ID=#{ITEM_ID,jdbcType=VARCHAR}
	</select>
	
	<!-- 通过user_id获取数据 显示item详细信息 -->
	<select id="findByItemByIdTwo" parameterType="pd" resultType="pd" useCache="false">
		SELECT ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_TYPE) AS ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.JOB_FORMAT) AS JOB_FORMAT , DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_MASS) AS ITEM_MASS , ITEM_DEPICT, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_PROVINCE) AS ITEM_PROVINCE ,
       (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.ITEM_CITY) AS ITEM_CITY
      , LOGIN_MANAGER, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.FIRE_GRADE)  AS FIRE_GRADE,
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.QUAKE_GRADE) AS QUAKE_GRADE, IS_CURTAIN, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.BASIC_DESIGN) AS BASIC_DESIGN , 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.BORDER_GRADE) AS BORDER_GRADE,
      IS_FLOOR, 
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.PIT_GRADE) AS PIT_GRADE , 
      BIANPO_HIGHT,
      (SELECT NAME FROM sys_dictionaries WHERE BIANMA=tt_iteminfo.JIEGOU_SHAPE) AS JIEGOU_SHAPE , PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS FROM tt_iteminfo	WHERE 	ITEM_ID=#{ITEM_ID}
	</select>
	
		
	
	<!-- 删除项目 -->
	  <update id="updateByIsDel" parameterType="pd">
  		 update tt_iteminfo   set   IS_DEL = #{isDel} where ITEM_ID=#{ITEM_ID}
	  </update>
	  
	  
	  <!-- 修改合同表的id为null -->
	  <update id="updateByProjectPactItem" parameterType="pd">
  		 update tt_project_pact   set   ITEM_ID = NULL where ITEM_ID=#{ITEM_ID}
	  </update>
	  <!-- 批量删除用户 -->
	<delete id="deleteAllItem" parameterType="String" flushCache="false">
		update tt_iteminfo
		 set
			IS_DEL =1 where ITEM_ID in 
  			 <foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                  #{item}
             </foreach>
	</delete>
	
	
	<select id="findIteminfoByStructid" parameterType="pd" resultType="pd" useCache="false">
		select 
			ITEM_ID, STRUCT_ID, ENFORCESTATE, 
      ITEM_NUMBER, ITEM_NAME, ITEM_TYPE, 
      WK_DATE, OTHER_UNIT, ITEM_MONEY, 
      START_DATE, END_DATE, FUND_SOURCE, 
      JOB_FORMAT, DETAILS_ADDRESS, ITEMEA_RMARK, 
      ITEMZD_AREA, ITEMDX_AREA, ITEM_AREA, 
      ITEM_MASS, ITEM_DEPICT, ITEM_PROVINCE, 
      ITEM_CITY, LOGIN_MANAGER, FIRE_GRADE, 
      QUAKE_GRADE, IS_CURTAIN, BASIC_DESIGN, 
      BORDER_GRADE, IS_FLOOR, PIT_GRADE, 
      BIANPO_HIGHT, JIEGOU_SHAPE, PIT_SHENDU, 
      BASEMENT_FLOOR, STRUCTURE_FLOOR, BUILDING_HIGHT, 
      SPAN, IS_DEL, CREATE_DATE, 
      CREATE_BY, UPDATE_DATE, UPDATE_BY, 
      APPROVAL_STATUS
		from 
			tt_iteminfo
		where 
			STRUCT_ID=#{STRUCT_ID} 
		  and IS_DEL=0
	</select>
	
		<!-- 修改项目审批状态 -->
	  <update id="updateByApprovalStatus" parameterType="pd">
	  UPDATE tt_iteminfo t SET t.`APPROVAL_STATUS`=#{approvalStatus},t.CC_ITEM_ID=#{CC_ITEM_ID,jdbcType=VARCHAR}  where  t.`ITEM_ID`=#{itemId}
	  </update>
	  
	  	<!-- 微信查看项目下的任务 -->
   <select id="findTaskAll" resultType="pd" parameterType="pd" >  
  SELECT   a.UID as TASK_ID, 
  (SELECT CONCAT(item_name,'->',(SELECT onlyPTaskName (UID)))  FROM `tt_iteminfo` WHERE item_id=#{ITEM_ID,jdbcType=VARCHAR}) as PNAME,
  NAME,  a.START,  a.FINISH,  (SELECT NAME FROM sys_user WHERE USER_ID = (
  (SELECT CONSTRUCTION_USER FROM tt_taskinfo WHERE UID= (SELECT findPTaskOneByCId(a.UID))))) AS   CONSTRUCTION_USER 
FROM  tt_taskinfo a WHERE UID IN   (SELECT     t.UID   FROM    tt_taskinfo t  WHERE t.PROJECTUID = #{ITEM_ID,jdbcType=VARCHAR})
 AND UID NOT IN (SELECT PARENTTASKUID FROM tt_taskinfo WHERE PROJECTUID=#{ITEM_ID,jdbcType=VARCHAR})
 <if test="NAME != null and NAME !='' ">
 AND NAME like #{NAME2,jdbcType=VARCHAR} 
 </if>
 <if test="reType==1">
 AND  FIND_IN_SET((SELECT USER_ID FROM `sys_user` WHERE OPEN_ID=#{OPEN_ID,jdbcType=VARCHAR}),
 (SELECT   GROUP_CONCAT(CONSTRUCTION_USER,',',SECURITY_USER,',',QUALITY_USER,',',TECHNOLOGY_USER,',',BUSINESS_USER) FROM tt_taskinfo WHERE UID=(SELECT findPTaskOneByCId(a.UID))))
  </if>
  <if test="reType==2">
 AND  a.TASK_STATE=0 
  </if>
  <if test="reType==3">
 AND  a.TASK_STATE=1 
  </if>
  <if test="reType==4">
 AND  a.TASK_STATE=2 
  </if>
  <if test="reType==5">
 AND  a.TASK_STATE=3  
  </if>
   <if test="reType==6">
 AND  a.APPROVAL_STATE=0  
  </if>
   <if test="reType==7">
 AND  a.APPROVAL_STATE=1  
  </if>
   <if test="reType==8">
 AND  a.APPROVAL_STATE=2  
  </if>
  order by CREATE_BY desc
  </select>
  
  <select id="listPageAllContractReviewById" resultType="pd" parameterType="pd" >
  SELECT 
  TRIBUNE_ID AS SEAL_REVIEW_ID,
  REVIEW_OBJ_ID AS SEAL_ID,
  TRIBUNE_TITLE AS TITLE,
  TRIBUNE_CONTENT AS CONTENT,
  CREATE_DATE,
  CREATE_BY,
  (SELECT 
    s.`NAME` 
  FROM
    `sys_user` s 
  WHERE s.`USER_ID` = k.CREATE_BY) AS CREATE_NAME,
  UPDATE_DATE,
  UPDATE_BY,
  STATE
FROM
  `tt_tribune` k 
WHERE REVIEW_OBJ_ID =#{pd.ITEM_ID,jdbcType=VARCHAR} 
  AND (
    k.`CREATE_BY` = #{pd.userid}
  ) 
  OR k.`TRIBUNE_ID` IN 
  (SELECT 
    l.`TRIBUNE_ID` 
  FROM
    `tt_tribune_user` l 
  WHERE l.`USER_ID` = #{pd.userid} 
    AND l.`TRIBUNE_ID` = k.`TRIBUNE_ID`AND REVIEW_OBJ_ID =#{pd.ITEM_ID,jdbcType=VARCHAR}) 
   <if test="pd.NAME != null and pd.NAME != ''"><!-- 关键词检索 -->
			and
				(
					 TITLE LIKE CONCAT(CONCAT('%', #{pd.NAME}),'%')
					 or 
					 CONTENT LIKE CONCAT(CONCAT('%', #{pd.NAME}),'%') 
				)
		</if>
		ORDER BY CREATE_DATE DESC
  </select>
  
   <select id="findStructinfobyNumber" resultType="pd" parameterType="pd" >
  	SELECT 
 item.*,
 CONCAT((SELECT s.`BM` FROM  `sys_structinfo` s WHERE s.`STRUCT_ID`=#{structId}),'_','000001') AS structidbm
 FROM (

 SELECT 
  CONCAT(
    SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', 1),
    '_',
    CASE WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))=1 
	THEN CONCAT('00000',SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))=2 
	THEN CONCAT('0000',SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))=3
	THEN CONCAT('000',SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))=4
	THEN CONCAT('00',SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))=5
	THEN CONCAT('0',SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	WHEN LENGTH(CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 ))>5
	THEN CONCAT(SUBSTRING_INDEX(MAX(str.`ITEM_NUMBER`), '_', - 1) + 1 )
	END
  ) AS ITEM_NUMBER
FROM
  `tt_iteminfo` str  WHERE str.`STRUCT_ID`=#{structId}
  AND 
  SUBSTRING_INDEX((str.`ITEM_NUMBER`), '_', 1) = (SELECT s.`BM` FROM  `sys_structinfo` s WHERE s.`STRUCT_ID`=#{structId})
  ) AS item
    </select>
</mapper>